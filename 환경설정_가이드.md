# 환경 설정 가이드

## 🎯 개요

무이상품권은 **개발(테스트)** 환경과 **프로덕션** 환경을 분리하여 운영합니다.

- **개발 환경**: 위즈페이 테스트 계정 사용 (실제 결제 없음)
- **프로덕션 환경**: 위즈페이 실제 가맹점 계정 사용 (실제 결제 발생)

---

## 📋 현재 상태: 개발 환경

현재는 **개발(테스트) 환경**으로 설정되어 있습니다.

### 개발 환경 설정

#### Vercel 환경 변수 설정

Vercel 대시보드에서 다음 환경 변수를 설정하세요:

1. **Vercel 대시보드 접속**
   ```
   https://vercel.com/[your-account]/muyi-giftcard/settings/environment-variables
   ```

2. **환경 변수 추가** (Environment: Production, Preview, Development 모두 선택)

```env
# 위즈페이 테스트 설정
NEXT_PUBLIC_WIZZPAY_URL=https://pgadmin.wizzpay.co.kr
WIZZPAY_MID=isptest03m
WIZZPAY_IV_KEY=7e74bfa70c4a79d827b500ab9a287d63
WIZZPAY_SALT=f8eb4a8a6873ba15e86668f1a17c0642
WIZZPAY_PASSWORD=1733

# 앱 설정
NEXT_PUBLIC_APP_URL=https://muyi-giftcard.vercel.app
NEXT_PUBLIC_BASE_URL=https://muyi-giftcard.vercel.app
```

#### 로컬 개발 환경

로컬에서 개발 시에는 `.env.development` 파일을 사용합니다:

```bash
# .env.development 파일이 이미 생성되어 있습니다
npm run dev
```

---

## 🚀 프로덕션 환경으로 전환

실제 서비스 오픈 시 아래 단계를 따라 프로덕션 환경으로 전환하세요.

### 1단계: 위즈페이 가맹점 신청

1. 위즈페이 고객센터 연락: **1544-3267**
2. 가맹점 계약 및 심사 진행
3. 발급받을 정보:
   - `MID` (가맹점 ID)
   - `IV_KEY` (암호화 키)
   - `SALT` (암호화 솔트)
   - `PASSWORD` (암호화 비밀번호)

### 2단계: Vercel 환경 변수 업데이트

Vercel 대시보드에서 **Production** 환경의 변수만 업데이트:

```env
# 위즈페이 프로덕션 설정
WIZZPAY_MID=실제_발급받은_MID
WIZZPAY_IV_KEY=실제_발급받은_IV_KEY
WIZZPAY_SALT=실제_발급받은_SALT
WIZZPAY_PASSWORD=실제_발급받은_PASSWORD
```

⚠️ **주의**: Preview와 Development 환경은 테스트 계정으로 유지하세요!

### 3단계: 재배포

```bash
# 코드 변경 없이 Vercel 재배포
vercel --prod
```

또는 GitHub에 push하면 자동 배포됩니다.

### 4단계: 프로덕션 테스트

1. 실제 소액(1,000원) 테스트 결제 진행
2. 결제 완료 확인
3. 환불 처리 (테스트 금액)
4. 로그 확인 및 모니터링

---

## 🔧 환경별 설정 파일

### 파일 구조

```
muyi-giftcard/
├── .env.development              # 개발 환경 (현재 사용 중)
├── .env.production.template      # 프로덕션 템플릿
├── .env.local                    # 로컬 개발용 (gitignore)
└── 환경설정_가이드.md            # 이 파일
```

### .env.development (현재 사용)

```env
# 위즈페이 테스트 계정
WIZZPAY_MID=isptest03m
WIZZPAY_IV_KEY=7e74bfa70c4a79d827b500ab9a287d63
WIZZPAY_SALT=f8eb4a8a6873ba15e86668f1a17c0642
WIZZPAY_PASSWORD=1733
```

✅ **안전**: 실제 결제가 발생하지 않습니다
✅ **테스트**: 위즈페이 테스트 화면에서 결제 플로우 확인 가능

### .env.production (프로덕션 전환 시 생성)

```bash
# .env.production.template을 복사하여 생성
cp .env.production.template .env.production

# 실제 값으로 교체
vi .env.production
```

⚠️ **위험**: 실제 결제가 발생합니다
⚠️ **보안**: 절대 Git에 커밋하지 마세요 (.gitignore에 포함됨)

---

## 📊 환경별 동작 확인

### 개발 환경 확인

```bash
# 로컬 개발 서버 실행
npm run dev

# 브라우저에서 확인
open http://localhost:3000

# 결제 테스트
# 1. 상품권 선택 (50,000원)
# 2. 구매하기 클릭
# 3. 정보 입력
# 4. 결제하기 클릭
# → 위즈페이 테스트 화면 표시 ✅
```

### 프로덕션 환경 확인

```bash
# Vercel 배포 후
open https://muyi-giftcard.vercel.app

# 소액 테스트 결제 (1,000원)
# 1. 상품권 선택
# 2. 실제 카드 정보 입력
# 3. 결제 완료 확인
# 4. 환불 처리 (필수!)
```

---

## 🛡️ 보안 체크리스트

### 필수 확인 사항

- [ ] `.env.production` 파일이 `.gitignore`에 포함되어 있는지 확인
- [ ] GitHub에 환경 변수가 노출되지 않았는지 확인
- [ ] Vercel 환경 변수가 올바르게 설정되었는지 확인
- [ ] 개발/프로덕션 환경이 분리되어 있는지 확인
- [ ] 프로덕션 키가 안전하게 보관되어 있는지 확인

### Vercel 환경 변수 확인

```bash
# Vercel CLI 설치
npm i -g vercel

# 환경 변수 목록 확인
vercel env ls

# 특정 환경 변수 확인
vercel env pull .env.local
```

---

## 🚨 문제 해결

### Q1: 결제하기 버튼 클릭 시 흰 페이지가 나타납니다

**원인**: 암호화 키 불일치 또는 데이터 형식 오류

**해결**:
1. Vercel 환경 변수 확인
2. `lib/wizzpay.ts` 코드 확인 (PBKDF2 사용)
3. JSON 키가 소문자인지 확인

### Q2: "가맹점 정보가 올바르지 않습니다" 에러

**원인**: MID가 잘못되었거나 만료됨

**해결**:
1. 위즈페이 고객센터 문의 (1544-3267)
2. MID 재확인 및 재발급

### Q3: 개발/프로덕션 환경이 섞입니다

**원인**: Vercel 환경 변수 설정 오류

**해결**:
1. Vercel 대시보드에서 환경별로 다른 값 설정
2. Preview = 테스트, Production = 실제
3. 재배포 후 확인

---

## 📞 지원

### 위즈페이 고객센터
- **전화**: 1544-3267
- **웹사이트**: www.wizzpay.co.kr
- **이메일**: support@wizzpay.co.kr

### 개발 문의
- GitHub Issues: [프로젝트 주소]
- 이메일: [개발팀 이메일]

---

**마지막 업데이트**: 2025년 11월 10일
**버전**: 1.0
**상태**: 개발 환경 구성 완료 ✅
