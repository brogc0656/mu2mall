# 해야 할 작업 체크리스트

**업데이트**: 2025-11-09  
**현재 상태**: 프록시 서버 구성 완료, 프로덕션 배포 완료

---

## 🎯 우선순위 높음 (필수)

### 1. 클라이프스 IP 등록 요청 ⭐⭐⭐⭐⭐

**현재 상황**:
- ✅ 프록시 서버 실행 중 (로컬 컴퓨터)
- ✅ 공인 IP 확인: `180.80.147.23`
- ⚠️ 클라이프스에 IP 등록 필요

**해야 할 일**:
클라이프스에 다음 내용으로 IP 등록 요청:

```
안녕하세요,

프로덕션 API 접근을 위해 다음 IP를 화이트리스트에 추가해주세요.

IP 주소: 180.80.147.23
서버: api.chlifes.co.kr
용도: Brother 상품권 API 연동
프로젝트: muyi-giftcard

감사합니다.
```

**체크**: [ ] 클라이프스에 IP 등록 요청 완료

---

### 2. Cloudflare Tunnel 설정 및 실행 ⭐⭐⭐⭐⭐

**현재 상황**:
- ✅ Cloudflare Tunnel 설치됨
- ⚠️ 터널 미설정

**해야 할 일**:

```bash
# 1. Cloudflare 로그인 (최초 1회)
cloudflared tunnel login

# 2. 터널 생성 (최초 1회)
cloudflared tunnel create chlifes-proxy

# 3. PM2로 터널 실행
pm2 start --name chlifes-tunnel -- cloudflared tunnel run chlifes-proxy --url http://localhost:3001
pm2 save

# 4. Tunnel URL 확인
pm2 logs chlifes-tunnel | grep -i "trycloudflare"
```

**결과**: `https://xxxx-xxxx-xxxx.trycloudflare.com` 형태의 URL 확인

**체크**: [ ] Cloudflare Tunnel 실행 완료
**체크**: [ ] Tunnel URL 확인 완료

---

### 3. Vercel 환경 변수 설정 ⭐⭐⭐⭐⭐

**현재 상황**:
- ✅ 프로덕션 배포 완료 (https://muyi-giftcard.vercel.app)
- ⚠️ `CHLIFES_PROXY_URL` 환경 변수 미설정

**해야 할 일**:

```bash
cd /Users/hasanghyeon/brother_site/muyi-giftcard

# 환경 변수 추가
vercel env add CHLIFES_PROXY_URL production

# 값 입력 (Cloudflare Tunnel URL + /proxy/chlifes):
# 예: https://xxxx-xxxx-xxxx.trycloudflare.com/proxy/chlifes
```

**재배포**:
```bash
vercel --prod
```

**체크**: [ ] Vercel 환경 변수 설정 완료
**체크**: [ ] 재배포 완료

---

## 🔍 우선순위 중간 (확인 필요)

### 4. 프로덕션 위즈페이 모듈 확인 ⭐⭐⭐⭐

**현재 상황**:
- ✅ 코드상으로는 정상 구성됨
- ⚠️ 실제 프로덕션에서 테스트 필요

**해야 할 일**:

1. **브라우저에서 직접 확인**:
   - https://muyi-giftcard.vercel.app 접속
   - 결제 버튼 클릭
   - 위즈페이 팝업이 정상적으로 열리는지 확인

2. **개발자 도구 확인**:
   - F12 → Console 탭
   - 에러 메시지 확인
   - Network 탭에서 `/api/payment/init` 요청 확인

**체크**: [ ] 프로덕션에서 위즈페이 모듈 정상 작동 확인

---

### 5. 전체 플로우 테스트 ⭐⭐⭐⭐

**해야 할 일**:

1. **결제 플로우 테스트**:
   - 상품권 선택
   - 금액 선택
   - 구매자 정보 입력
   - 결제 진행
   - 위즈페이 팝업 확인
   - 결제 완료 확인

2. **상품권 발송 확인**:
   - 결제 완료 후
   - Supabase에서 거래 내역 확인
   - 클라이프스 API 호출 확인 (프록시 서버 로그)

**체크**: [ ] 전체 플로우 테스트 완료

---

## 📋 우선순위 낮음 (선택사항)

### 6. 자동 시작 설정 완료 ⭐⭐⭐

**현재 상황**:
- ✅ PM2 설정 저장됨
- ⚠️ 컴퓨터 재부팅 시 자동 시작 미설정

**해야 할 일**:

```bash
# 자동 시작 설정
pm2 startup

# 출력된 명령어 실행 (예시):
sudo env PATH=$PATH:/Users/hasanghyeon/.nvm/versions/node/v20.19.5/bin /Users/hasanghyeon/.nvm/versions/node/v20.19.5/lib/node_modules/pm2/bin/pm2 startup launchd -u hasanghyeon --hp /Users/hasanghyeon

# 설정 저장
pm2 save
```

**체크**: [ ] 자동 시작 설정 완료

---

### 7. 모니터링 대시보드 확인 ⭐⭐⭐

**현재 상황**:
- ✅ 모니터링 대시보드 실행 중
- ✅ http://localhost:3002 접속 가능

**해야 할 일**:
- 브라우저에서 http://localhost:3002 접속
- 프록시 서버 상태 확인
- 로그 확인

**체크**: [ ] 모니터링 대시보드 확인 완료

---

## 🎯 최종 확인 사항

### 프로덕션 준비 완료 체크리스트

- [ ] 클라이프스 IP 등록 완료
- [ ] Cloudflare Tunnel 실행 중
- [ ] Vercel 환경 변수 설정 완료
- [ ] 프로덕션 재배포 완료
- [ ] 위즈페이 모듈 정상 작동 확인
- [ ] 전체 플로우 테스트 완료

---

## 📝 작업 순서 (권장)

### 1단계: 클라이프스 IP 등록 요청
→ 가장 먼저 해야 함 (처리 시간 필요)

### 2단계: Cloudflare Tunnel 설정
→ IP 등록 대기 중에 진행 가능

### 3단계: Vercel 환경 변수 설정
→ Tunnel URL 확인 후 진행

### 4단계: 프로덕션 테스트
→ 모든 설정 완료 후 진행

---

## ⚠️ 주의사항

1. **프록시 서버는 항상 켜져 있어야 함**
   - 컴퓨터를 끄면 프로덕션에서 클라이프스 API 호출 불가
   - PM2 자동 시작 설정 권장

2. **Cloudflare Tunnel URL은 변경될 수 있음**
   - 임시 URL 사용 시 매번 변경됨
   - 고정 도메인 사용 권장 (선택사항)

3. **환경 변수 설정 후 재배포 필수**
   - Vercel 환경 변수 변경 시 재배포 필요

---

## 🆘 문제 발생 시

### 프록시 서버가 작동하지 않을 때
```bash
pm2 restart chlifes-proxy
pm2 logs chlifes-proxy
```

### Cloudflare Tunnel이 작동하지 않을 때
```bash
pm2 restart chlifes-tunnel
pm2 logs chlifes-tunnel
```

### 프로덕션에서 위즈페이가 작동하지 않을 때
1. 브라우저 개발자 도구 확인
2. Vercel 로그 확인: `vercel logs`
3. 환경 변수 확인: Vercel 대시보드

---

**마지막 업데이트**: 2025-11-09

