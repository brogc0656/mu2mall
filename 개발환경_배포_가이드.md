# 개발 환경 배포 가이드

## 🚀 빠른 시작 (3단계)

### 1단계: 코드 수정 사항 커밋

```bash
# 현재 상태 확인
git status

# 수정된 파일 확인
# - lib/wizzpay.ts (위즈페이 암호화 수정)

# 커밋 (이미 완료됨)
git log -1
```

✅ **커밋 완료**: "Fix: 위즈페이 연동 수정 - JSON 키 소문자 변경 및 PBKDF2 암호화 적용"

### 2단계: GitHub에 Push

```bash
# Push (권한 문제 해결 필요)
git push

# 권한 문제 시 SSH 사용
git remote set-url origin git@github.com:brogc0656/mu2mall.git
git push
```

### 3단계: Vercel 환경 변수 설정

#### 방법 A: 자동 스크립트 사용 (권장)

```bash
# Vercel CLI 설치 (아직 없다면)
npm install -g vercel

# 로그인
vercel login

# 자동 설정 스크립트 실행
bash setup-vercel-env.sh
```

#### 방법 B: 수동 설정

Vercel 대시보드에서 직접 설정:

1. https://vercel.com 접속
2. 프로젝트 선택: `muyi-giftcard`
3. Settings → Environment Variables 클릭
4. 아래 변수 추가 (Production, Preview, Development 모두 체크)

```env
NEXT_PUBLIC_WIZZPAY_URL=https://pgadmin.wizzpay.co.kr
WIZZPAY_MID=isptest03m
WIZZPAY_IV_KEY=7e74bfa70c4a79d827b500ab9a287d63
WIZZPAY_SALT=f8eb4a8a6873ba15e86668f1a17c0642
WIZZPAY_PASSWORD=1733
NEXT_PUBLIC_APP_URL=https://muyi-giftcard.vercel.app
NEXT_PUBLIC_BASE_URL=https://muyi-giftcard.vercel.app
```

5. Save 클릭

---

## 🧪 테스트 및 확인

### 배포 완료 대기

GitHub push 후 Vercel이 자동으로 배포합니다:

1. Vercel 대시보드에서 배포 진행 상황 확인
2. 빌드 로그 확인
3. 배포 완료 확인 (3-5분 소요)

### 기능 테스트

배포 완료 후 프로덕션 사이트에서 테스트:

```bash
# 브라우저에서 열기
open https://muyi-giftcard.vercel.app
```

#### 테스트 시나리오

1. **메인 페이지 로드**
   - ✅ 상품권 카드가 표시되는지 확인
   - ✅ 금액 버튼이 표시되는지 확인

2. **상품 선택**
   - 신세계상품권 선택
   - 50,000원 버튼 클릭
   - "지금 구매하기" 버튼 클릭

3. **정보 입력**
   - 이름: `테스트구매자`
   - 전화번호: `01012345678`
   - 이메일: `test@example.com`

4. **결제하기 버튼 클릭** ⭐
   - ❌ **이전**: 흰 페이지 표시
   - ✅ **수정 후**: 위즈페이 테스트 결제 화면 표시

5. **위즈페이 테스트 화면 확인**
   - 상품명: 신세계상품권
   - 금액: 50,000원
   - 테스트 카드 정보 입력 가능

---

## 📊 현재 환경 상태

### ✅ 개발(테스트) 환경

- **위즈페이**: 테스트 계정 (`isptest03m`)
- **결제**: 실제 결제 발생 안함
- **테스트**: 위즈페이 테스트 화면에서 결제 플로우 확인
- **안전**: 실제 금전 거래 없음

### 📝 설정된 파일

```
muyi-giftcard/
├── .env.development              ✅ 개발 환경 설정
├── .env.production.template      📋 프로덕션 템플릿 (나중에 사용)
├── lib/wizzpay.ts                ✅ 수정 완료 (PBKDF2 암호화)
├── setup-vercel-env.sh           ✅ 자동 설정 스크립트
├── 환경설정_가이드.md            📘 상세 가이드
└── 개발환경_배포_가이드.md       📘 이 파일
```

---

## 🔄 프로덕션 전환 (나중에)

실제 서비스 오픈 시 프로덕션으로 전환:

### 1. 위즈페이 가맹점 신청

- 고객센터: 1544-3267
- 가맹점 계약 및 심사
- 실제 MID, 키 발급

### 2. Vercel 환경 변수 업데이트

**Production 환경만** 업데이트:

```env
WIZZPAY_MID=실제_발급받은_MID
WIZZPAY_IV_KEY=실제_발급받은_IV_KEY
WIZZPAY_SALT=실제_발급받은_SALT
WIZZPAY_PASSWORD=실제_발급받은_PASSWORD
```

⚠️ **주의**: Preview와 Development는 테스트 계정 유지!

### 3. 재배포 및 테스트

```bash
# 재배포
vercel --prod

# 소액 테스트 (1,000원)
# → 실제 결제 발생
# → 확인 후 환불 처리
```

---

## 🛠️ 문제 해결

### Q: git push 권한 오류

```bash
# SSH 키 사용으로 전환
git remote set-url origin git@github.com:brogc0656/mu2mall.git
git push
```

### Q: Vercel 배포 실패

1. Vercel 대시보드에서 빌드 로그 확인
2. 환경 변수가 올바르게 설정되었는지 확인
3. `vercel env pull .env.local`로 로컬에서 확인

### Q: 여전히 흰 페이지 표시

1. Vercel 환경 변수 확인 (대시보드)
2. 재배포 트리거 (Deployments → Redeploy)
3. 브라우저 캐시 삭제 (Cmd+Shift+R)
4. 개발자 도구 Console 에러 확인

---

## ✅ 체크리스트

배포 전 확인:

- [ ] `lib/wizzpay.ts` 수정 완료 (PBKDF2 암호화)
- [ ] Git 커밋 완료
- [ ] GitHub push 완료
- [ ] Vercel 환경 변수 설정 완료
- [ ] Vercel 배포 완료 (3-5분 대기)

배포 후 확인:

- [ ] https://muyi-giftcard.vercel.app 접속
- [ ] 상품 선택 및 구매하기 클릭
- [ ] 정보 입력
- [ ] **결제하기 버튼 클릭 → 위즈페이 화면 표시** ⭐
- [ ] 테스트 결제 플로우 확인

---

## 📞 지원

- **위즈페이 고객센터**: 1544-3267
- **Vercel 문서**: https://vercel.com/docs
- **프로젝트 이슈**: GitHub Issues

---

**작성일**: 2025년 11월 10일
**버전**: 1.0
**상태**: 개발 환경 구성 완료 ✅
