# 로컬 컴퓨터 프록시 서버 구성 방안

**일시**: 2025-11-09  
**목적**: 로컬 컴퓨터를 프록시 서버로 사용하여 클라이프스 프로덕션 API 접근  
**전제**: 로컬 컴퓨터에 고정 공인 IP가 있는 경우

---

## 🔍 사전 확인 필요

### 1. 공인 IP vs 사설 IP 확인

```bash
# 공인 IP 확인
curl https://api.ipify.org

# 로컬 IP 확인
ifconfig | grep "inet "
```

**확인 사항**:
- ✅ **공인 IP**: 인터넷에서 직접 접근 가능 → 프록시 서버로 사용 가능
- ❌ **사설 IP** (192.168.x.x, 10.x.x.x, 172.16-31.x.x): 라우터 뒤에 있음 → 포트 포워딩 필요

---

## 💡 방법 1: 로컬 컴퓨터 직접 사용 (공인 IP 있는 경우)

### 장점
- ✅ **비용**: $0
- ✅ **설정 간단**: Node.js 서버만 실행
- ✅ **완전한 제어**: 로컬에서 모든 관리

### 단점
- ⚠️ **컴퓨터 항상 켜져 있어야 함**: 24/7 운영 필요
- ⚠️ **전력 소비**: 지속적인 전력 사용
- ⚠️ **네트워크 의존**: 인터넷 연결이 끊기면 서비스 중단
- ⚠️ **보안 관리**: 방화벽, 보안 패치 필요

### 구현 방법

#### 1. Node.js 프록시 서버 구축

```javascript
// proxy-server.js
const express = require('express');
const cors = require('cors');
const app = express();

app.use(cors());
app.use(express.json());

// 클라이프스 API 프록시
app.post('/proxy/chlifes/*', async (req, res) => {
  const path = req.path.replace('/proxy/chlifes', '');
  const url = `https://api.chlifes.co.kr${path}`;
  
  try {
    const response = await fetch(url, {
      method: req.method,
      headers: {
        'Content-Type': 'application/json; charset=utf-8',
        ...req.headers,
      },
      body: JSON.stringify(req.body),
    });
    
    const data = await response.json();
    res.json(data);
  } catch (error) {
    console.error('Proxy error:', error);
    res.status(500).json({ error: error.message });
  }
});

const PORT = process.env.PORT || 3001;
app.listen(PORT, '0.0.0.0', () => {
  console.log(`Proxy server running on http://0.0.0.0:${PORT}`);
  console.log(`Your public IP: ${process.env.PUBLIC_IP || '확인 필요'}`);
});
```

#### 2. PM2로 프로세스 관리

```bash
# PM2 설치
npm install -g pm2

# 서버 시작
pm2 start proxy-server.js --name chlifes-proxy

# 자동 시작 설정 (컴퓨터 재부팅 시 자동 실행)
pm2 startup
pm2 save
```

#### 3. 방화벽 설정 (macOS)

```bash
# 방화벽에서 포트 허용
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/local/bin/node
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --unblockapp /usr/local/bin/node
```

#### 4. Vercel에서 프록시 사용

```typescript
// lib/chlifes.ts
const CHLIFES_CONFIG = {
  // 프로덕션에서는 로컬 프록시 서버 사용
  API_URL: process.env.NODE_ENV === 'production' && process.env.CHLIFES_PROXY_URL
    ? process.env.CHLIFES_PROXY_URL  // 예: http://your-public-ip:3001/proxy/chlifes
    : process.env.NEXT_PUBLIC_CHLIFES_URL,
  // ...
};
```

---

## 💡 방법 2: 포트 포워딩 (사설 IP인 경우)

### 사전 요구사항
- 라우터 관리자 권한
- 공유기 설정 접근 가능

### 설정 방법

#### 1. 라우터 포트 포워딩 설정
```
외부 포트: 3001 (또는 원하는 포트)
내부 IP: 192.168.x.x (로컬 컴퓨터 IP)
내부 포트: 3001
프로토콜: TCP
```

#### 2. 동적 DNS 설정 (선택)
- 공인 IP가 유동 IP인 경우
- DDNS 서비스 사용 (예: DuckDNS, No-IP)
- 도메인으로 접근 가능

---

## 💡 방법 3: ngrok (가장 간단한 임시 해결책)

### 장점
- ✅ **설정 매우 간단**: 5분이면 완료
- ✅ **HTTPS 자동 제공**
- ✅ **공인 IP 불필요**: 터널링 사용

### 단점
- ⚠️ **무료 플랜 제한**: URL이 매번 변경됨
- ⚠️ **유료 플랜 필요**: 고정 URL은 $8/월
- ⚠️ **컴퓨터 항상 켜져 있어야 함**

### 구현 방법

```bash
# ngrok 설치
brew install ngrok  # macOS
# 또는 https://ngrok.com/download

# ngrok 계정 생성 및 인증 토큰 설정
ngrok config add-authtoken YOUR_TOKEN

# 로컬 프록시 서버 실행 (포트 3001)
node proxy-server.js

# 다른 터미널에서 ngrok 터널 생성
ngrok http 3001
```

**결과**:
```
Forwarding: https://abc123.ngrok.io -> http://localhost:3001
```

**Vercel 환경 변수**:
```
CHLIFES_PROXY_URL=https://abc123.ngrok.io/proxy/chlifes
```

---

## 💡 방법 4: Cloudflare Tunnel (무료, 추천)

### 장점
- ✅ **완전 무료**: 고정 URL 제공
- ✅ **HTTPS 자동 제공**
- ✅ **보안 강화**: Cloudflare 보호
- ✅ **설정 간단**

### 단점
- ⚠️ **컴퓨터 항상 켜져 있어야 함**

### 구현 방법

```bash
# Cloudflare Tunnel 설치
brew install cloudflared  # macOS

# 로그인
cloudflared tunnel login

# 터널 생성
cloudflared tunnel create chlifes-proxy

# 라우팅 설정
cloudflared tunnel route dns chlifes-proxy proxy.yourdomain.com

# 터널 실행
cloudflared tunnel run chlifes-proxy
```

---

## 🆚 방법 비교

| 방법 | 비용 | 복잡도 | 고정 IP | 추천도 |
|------|------|--------|---------|--------|
| **로컬 직접** | $0 | 중간 | ✅ | ⭐⭐⭐ |
| **포트 포워딩** | $0 | 높음 | ✅ | ⭐⭐ |
| **ngrok** | $0-8/월 | 낮음 | ⚠️ | ⭐⭐⭐⭐ |
| **Cloudflare Tunnel** | $0 | 낮음 | ✅ | ⭐⭐⭐⭐⭐ |
| **AWS EC2** | $0-15/월 | 중간 | ✅ | ⭐⭐⭐⭐ |
| **클라이프스 협의** | $0 | 낮음 | N/A | ⭐⭐⭐⭐⭐ |

---

## 🎯 최종 추천

### 우선순위 1: 클라이프스 협의 ⭐⭐⭐⭐⭐
- 비용: $0
- 복잡도: 낮음
- **가장 추천**

### 우선순위 2: Cloudflare Tunnel ⭐⭐⭐⭐⭐
- 비용: $0
- 복잡도: 낮음
- 고정 URL 제공
- **로컬 서버 사용 시 가장 추천**

### 우선순위 3: ngrok (임시 테스트용) ⭐⭐⭐⭐
- 비용: $0 (무료 플랜)
- 복잡도: 매우 낮음
- **빠른 테스트에 적합**

### 우선순위 4: AWS EC2 ⭐⭐⭐⭐
- 비용: $0-15/월
- 복잡도: 중간
- **24/7 운영 필요 시**

---

## 📋 로컬 서버 사용 체크리스트

### 필수 확인사항
- [ ] 공인 IP 확인
- [ ] 방화벽 설정
- [ ] 포트 포워딩 (사설 IP인 경우)
- [ ] 컴퓨터 자동 시작 설정
- [ ] PM2 또는 systemd로 프로세스 관리
- [ ] 모니터링 설정 (선택)

### 보안 체크리스트
- [ ] 방화벽에서 필요한 포트만 열기
- [ ] HTTPS 사용 (ngrok, Cloudflare Tunnel 자동 제공)
- [ ] 인증 추가 (선택, API Key 등)
- [ ] 로그 모니터링

---

## 🚀 빠른 시작 (Cloudflare Tunnel)

### 1단계: Cloudflare Tunnel 설치
```bash
brew install cloudflared
```

### 2단계: 로그인 및 터널 생성
```bash
cloudflared tunnel login
cloudflared tunnel create chlifes-proxy
```

### 3단계: 프록시 서버 실행
```bash
# proxy-server.js 실행
node proxy-server.js  # 포트 3001
```

### 4단계: 터널 실행
```bash
cloudflared tunnel run chlifes-proxy --url http://localhost:3001
```

### 5단계: Vercel 환경 변수 설정
```
CHLIFES_PROXY_URL=https://chlifes-proxy.yourdomain.com/proxy/chlifes
```

---

## ⚠️ 주의사항

### 로컬 서버 사용 시
1. **컴퓨터가 항상 켜져 있어야 함**
   - 전력 소비
   - 네트워크 연결 유지 필요

2. **보안 관리**
   - 방화벽 설정
   - 정기적인 보안 패치

3. **모니터링**
   - 서버 상태 확인
   - 로그 모니터링

4. **백업 계획**
   - 컴퓨터 장애 시 대비
   - AWS EC2 등 대안 준비

---

## 💡 실용적 조언

### 지금 당장 테스트하려면?
**→ ngrok 사용** (5분이면 완료)

### 장기적으로 운영하려면?
**→ Cloudflare Tunnel** (무료, 고정 URL)

### 24/7 안정적 운영이 필요하면?
**→ AWS EC2** (서버 관리 부담 있지만 안정적)

### 가장 간단한 방법은?
**→ 클라이프스 협의** (비용 없음, 유지보수 없음)

---

**결론**: 로컬 컴퓨터를 서버로 사용하는 것은 **가능하지만**, Cloudflare Tunnel이나 ngrok 같은 터널링 서비스를 사용하는 것이 더 간단하고 안전합니다.

**마지막 업데이트**: 2025-11-09

